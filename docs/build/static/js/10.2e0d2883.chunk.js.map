{"version":3,"sources":["pages/users/EditModalHooks.jsx","pages/users/UserListHooks.jsx","../delegated 59 from dll-reference reactVendor_176180990e8e122c54da","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"],"names":["config","modal","props","isEdit","useState","data","setData","id","onOk","useForm","form","useGet","loading","fetchUser","usePost","successTip","saving","saveUser","usePut","updating","updateUser","fetchData","a","console","log","res","setFieldsValue","values","ajaxMethod","useEffect","formProps","labelWidth","modalLoading","okText","cancelText","submit","onCancel","resetFields","onFinish","initialValues","type","name","label","required","noSpace","options","value","mode","showSearch","optionFilterProp","path","title","pageNum","setPageNum","pageSize","setPageSize","dataSource","setDataSource","selectedRowKeys","setSelectedRowKeys","total","setTotal","visible","setVisible","setId","ajax","fetchUsers","api","deleteUsers","deleting","useDel","errorTip","deletingOne","deleteUser","columns","dataIndex","width","render","record","items","onClick","color","confirm","onConfirm","handleDelete","handleSearch","getFieldsValue","params","list","batchDeleteConfirm","length","ids","pageLoading","disabledDelete","allowClear","onChange","layout","htmlType","danger","disabled","rowSelection","rowKey","serialNumber","onPageNumChange","onPageSizeChange","module","exports","__webpack_require__","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined"],"mappings":"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","file":"static/js/10.2e0d2883.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Form } from 'antd';\nimport { FormElement } from 'ra-lib';\nimport config from 'src/commons/config-hoc';\nimport { ModalContent } from 'ra-lib';\nimport { useGet, usePost, usePut } from 'src/commons/ajax';\n\nexport default config({\n    modal: props => props.isEdit ? '修改用户' : '添加用户',\n})(props => {\n    const [ data, setData ] = useState({});\n    const { isEdit, id, onOk } = props;\n    const [ form ] = Form.useForm();\n    const [ loading, fetchUser ] = useGet('/mock/users/:id');\n    const [ saving, saveUser ] = usePost('/mock/users', { successTip: '添加成功！' });\n    const [ updating, updateUser ] = usePut('/mock/users', { successTip: '添加成功！' });\n\n    async function fetchData() {\n        if (loading) return;\n        console.log(id);\n\n        const res = await fetchUser(id);\n\n        setData(res || {});\n        form.setFieldsValue(res || {});\n    }\n\n    async function handleSubmit(values) {\n        if (saving || updating) return;\n\n        const ajaxMethod = isEdit ? updateUser : saveUser;\n        await ajaxMethod(values);\n\n        onOk && onOk();\n    }\n\n    useEffect(() => {\n        (async () => {\n            if (isEdit) await fetchData();\n        })();\n    }, []);\n\n    const formProps = {\n        labelWidth: 100,\n    };\n    const modalLoading = loading || saving || updating;\n    return (\n        <ModalContent\n            loading={modalLoading}\n            okText=\"保存\"\n            cancelText=\"重置\"\n            onOk={() => form.submit()}\n            onCancel={() => form.resetFields()}\n        >\n            <Form\n                form={form}\n                onFinish={handleSubmit}\n                initialValues={data}\n            >\n                {isEdit ? <FormElement {...formProps} type=\"hidden\" name=\"id\"/> : null}\n\n                <FormElement\n                    {...formProps}\n                    label=\"用户名\"\n                    name=\"name\"\n                    required\n                    noSpace\n                />\n                <FormElement\n                    {...formProps}\n                    type=\"number\"\n                    label=\"年龄\"\n                    name=\"age\"\n                    required\n                />\n                <FormElement\n                    {...formProps}\n                    type=\"select\"\n                    label=\"工作\"\n                    name=\"job\"\n                    options={[\n                        { value: '1', label: '前端开发' },\n                        { value: '2', label: '后端开发' },\n                    ]}\n                />\n                <FormElement\n                    {...formProps}\n                    type=\"select\"\n                    label=\"职位\"\n                    name=\"position\"\n                    options={[\n                        { value: '1', label: '员工' },\n                        { value: '2', label: 'CEO' },\n                    ]}\n                />\n                <FormElement\n                    {...formProps}\n                    type=\"select\"\n                    mode=\"multiple\"\n                    showSearch\n                    optionFilterProp='children'\n                    label=\"角色\"\n                    name=\"role\"\n                    options={[\n                        { value: '1', label: '员工' },\n                        { value: '2', label: 'CEO' },\n                    ]}\n                />\n            </Form>\n        </ModalContent>\n    );\n});\n\n\n","import React, { useEffect, useState } from 'react';\nimport { Button, Form } from 'antd';\n\nimport { PageContent, batchDeleteConfirm } from 'ra-lib';\nimport config from 'src/commons/config-hoc';\nimport api from './useApi';\nimport {\n    FormElement,\n    FormRow,\n    Operator,\n    Pagination,\n    QueryBar,\n    Table,\n} from 'ra-lib';\n\nimport EditModal from './EditModalHooks';\n\nexport default config({\n    path: '/hook/users',\n    title: '用户管理(Hooks)',\n})((props) => {\n    // 数据定义\n    const [ pageNum, setPageNum ] = useState(1);\n    const [ pageSize, setPageSize ] = useState(20);\n    const [ dataSource, setDataSource ] = useState([]);\n    const [ selectedRowKeys, setSelectedRowKeys ] = useState([]);\n    const [ total, setTotal ] = useState(0);\n    const [ visible, setVisible ] = useState(false);\n    const [ id, setId ] = useState(null);\n    const [ form ] = Form.useForm();\n\n    // 请求相关定义 只是定义，不会触发请求，调用相关函数，才会触发请求\n    const [ loading, fetchUsers ] = props.ajax.useGet('/mock/users');\n    const [ deleting, deleteUsers ] = api.deleteUsers(); // 可以单独封装成api\n    const [ deletingOne, deleteUser ] = props.ajax.useDel('/mock/users/:id', { successTip: '删除成功！', errorTip: '删除失败！' });\n\n    const columns = [\n        { title: '用户名', dataIndex: 'name', width: 200 },\n        { title: '年龄', dataIndex: 'age', width: 200 },\n        { title: '工作', dataIndex: 'job', width: 200 },\n        { title: '职位', dataIndex: 'position', width: 200 },\n        {\n            title: '操作', dataIndex: 'operator', width: 100,\n            render: (value, record) => {\n                const { id, name } = record;\n                const items = [\n                    {\n                        label: '编辑',\n                        onClick: () => setVisible(true) || setId(id),\n                    },\n                    {\n                        label: '删除',\n                        color: 'red',\n                        confirm: {\n                            title: `您确定删除\"${name}\"?`,\n                            onConfirm: () => handleDelete(id),\n                        },\n                    },\n                ];\n\n                return <Operator items={items}/>;\n            },\n        },\n    ];\n\n    // 函数定义\n    async function handleSearch(options = {}) {\n        if (loading) return;\n\n        // 获取表单数据\n        const values = form.getFieldsValue();\n        const params = {\n            ...values,\n        };\n\n        // 翻页信息优先从参数中获取\n        params.pageNum = options.pageNum || pageNum;\n        params.pageSize = options.pageSize || pageSize;\n\n        console.log('params:', params);\n        const res = await fetchUsers(params);\n        console.log('res:', res);\n\n        setDataSource(res?.list || []);\n        setTotal(res?.total || 0);\n        setPageNum(params.pageNum);\n        setPageSize(params.pageSize);\n    }\n\n    async function handleDelete(id) {\n        if (deletingOne) return;\n\n        await deleteUser(id);\n        await handleSearch();\n    }\n\n    async function handleBatchDelete() {\n        if (deleting) return;\n\n        await batchDeleteConfirm(selectedRowKeys.length);\n\n        await deleteUsers({ ids: selectedRowKeys });\n        setSelectedRowKeys([]);\n        await handleSearch();\n    }\n\n    // 组件初始化完成之后，进行一次查询\n    useEffect(() => {\n        (async () => {\n            await handleSearch();\n        })();\n    }, []);\n\n    // jsx 用到的数据\n    const formProps = { width: 200 };\n    const pageLoading = loading || deleting || deletingOne;\n    const disabledDelete = !selectedRowKeys?.length || pageLoading;\n\n\n    console.log('render');\n    return (\n        <PageContent loading={pageLoading}>\n            <QueryBar>\n                <Form form={form} onFinish={() => handleSearch({ pageNum: 1 })}>\n                    <FormRow>\n                        <FormElement\n                            {...formProps}\n                            label=\"名称\"\n                            name=\"name\"\n                        />\n                        <FormElement\n                            {...formProps}\n                            allowClear\n                            type=\"select\"\n                            label=\"职位\"\n                            name=\"job\"\n                            onChange={() => handleSearch({ pageNum: 1 })}\n                            options={[\n                                { value: 1, label: 1 },\n                                { value: 2, label: 2 },\n                            ]}\n                        />\n                        <FormElement layout>\n                            <Button type=\"primary\" htmlType=\"submit\">查询</Button>\n                            <Button onClick={() => form.resetFields()}>重置</Button>\n                            <Button type=\"primary\" onClick={() => setVisible(true) || setId(null)}>添加</Button>\n                            <Button danger disabled={disabledDelete} onClick={handleBatchDelete}>删除</Button>\n                        </FormElement>\n                    </FormRow>\n                </Form>\n            </QueryBar>\n            <Table\n                rowSelection={{\n                    selectedRowKeys,\n                    onChange: setSelectedRowKeys,\n                }}\n                columns={columns}\n                dataSource={dataSource}\n                rowKey=\"id\"\n                serialNumber\n                pageNum={pageNum}\n                pageSize={pageSize}\n            />\n            <Pagination\n                total={total}\n                pageNum={pageNum}\n                pageSize={pageSize}\n                onPageNumChange={pageNum => handleSearch({ pageNum })}\n                onPageSizeChange={pageSize => handleSearch({ pageNum: 1, pageSize })}\n            />\n            <EditModal\n                visible={visible}\n                id={id}\n                isEdit={id !== null}\n                onOk={() => setVisible(false) || handleSearch({ pageNum: 1 })}\n                onCancel={() => setVisible(false)}\n            />\n        </PageContent>\n    );\n});\n","module.exports = (__webpack_require__(5))(59);","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}"],"sourceRoot":""}