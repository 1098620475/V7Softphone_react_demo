(this["webpackJsonpreact-adminv4"]=this["webpackJsonpreact-adminv4"]||[]).push([[11],{227:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));n(121);var a,r=n(90),i=(n(122),n(91)),l=(n(68),n(35)),o=(n(22),n(26)),c=n(5),s=n(1),u=n(2),d=n(3),f=n(4),p=n(0),m=n.n(p),h=n(82),b=n(19),v=n(8),y=n(9),g=n(11),S=n(23);n(240);var j,k,E=Object(b.a)({ajax:!0})(a=function(e){Object(f.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={loading:!1,menus:[],allMenuKeys:[],expandedRowKeys:[]},e.columns=[{title:"\u540d\u79f0",dataIndex:"text",key:"text",render:function(e,t){var n=t.icon;return n?m.a.createElement("span",null,m.a.createElement(g.e,{type:n})," ",e):e}},{title:"\u7c7b\u578b",dataIndex:"type",key:"type",render:function(e,t){return t.url?"\u7ad9\u5916\u83dc\u5355":"1"===e?"\u7ad9\u5185\u83dc\u5355":"2"===e?"\u529f\u80fd":"\u83dc\u5355"}}],e.handleSelect=function(t,n,a,r){var i,l,o=e.props.value,c=void 0===o?[]:o,s=e.state.menus,u=t.key,d=Object(y.a)(c),f=Object(S.b)(s,u),p=t.parentKeys,m=void 0===p?[]:p;n?d=(l=d=(i=d).concat.apply(i,[u].concat(Object(y.a)(f)))).concat.apply(l,Object(y.a)(m)):(d=d.filter((function(e){return![u].concat(Object(y.a)(f)).includes(e)})),m.reverse().forEach((function(e){Object(S.b)(s,e).some((function(e){return d.includes(e)}))?d.push(e):d=d.filter((function(t){return t!==e}))})));var h=e.props.onChange;h&&h(Array.from(new Set(d)))},e.handleSelectAll=function(t){var n=e.state.allMenuKeys,a=e.props.onChange;a&&a(t?n:[])},e.indeterminate=function(t){var n=e.props.value,a=e.state.menus,r=t.key,i=Object(S.b)(a,r);return n.includes(r)&&n.some((function(e){return i.includes(e)}))&&!i.every((function(e){return n.includes(e)}))},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.handleSearch()}},{key:"handleSearch",value:function(){var e=this;this.setState({loading:!0}),this.props.ajax.get("/menus").then((function(t){var n=t.map((function(e){return Object(c.a)({key:e.id,parentKey:e.parentId},e)})),a=n.map((function(e){return e.key})),r=Object(y.a)(n).sort((function(e,t){var n=e.order||0,a=t.order||0;return n||a?a-n:e.text>t.text?1:-1})),i=Object(S.a)(r),l=n.map((function(e){return e.key}));e.setState({menus:i,allMenuKeys:a,expandedRowKeys:l})})).finally((function(){return e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.menus,a=t.loading,r=t.expandedRowKeys,i=this.props,l=i.value,o=(i.onChange,Object(v.a)(i,["value","onChange"]));return m.a.createElement(g.k,Object.assign({expandable:{expandedRowKeys:r,onExpandedRowsChange:function(t){return e.setState({expandedRowKeys:t})}},rowSelection:{selectedRowKeys:l,onSelect:this.handleSelect,onSelectAll:this.handleSelectAll,getCheckboxProps:function(t){return{indeterminate:e.indeterminate(t)}}},loading:a,columns:this.columns,dataSource:n,pagination:!1},o))}}]),n}(p.Component))||a,O=Object(b.a)({ajax:!0,modal:{title:function(e){return e.isEdit?"\u4fee\u6539":"\u6dfb\u52a0"}}})(j=function(e){Object(f.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={loading:!1,data:{}},e.fetchData=function(){if(!e.state.loading){var t=e.props.id;e.setState({loading:!0}),e.props.ajax.get("/mock/roles/".concat(t)).then((function(t){e.setState({data:t||{}}),e.form.setFieldsValue(t)})).finally((function(){return e.setState({loading:!1})}))}},e.handleSubmit=function(t){if(!e.state.loading){var n=e.props.isEdit,a=n?"\u4fee\u6539\u6210\u529f\uff01":"\u6dfb\u52a0\u6210\u529f\uff01",r=n?e.props.ajax.put:e.props.ajax.post;e.setState({loading:!0}),r("/role",t,{successTip:a}).then((function(){var t=e.props.onOk;t&&t()})).finally((function(){return e.setState({loading:!1})}))}},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.props.isEdit&&this.fetchData()}},{key:"render",value:function(){var e=this,t=this.props.isEdit,n=this.state,a=n.loading,r=n.data,i={labelWidth:100};return m.a.createElement(g.g,{loading:a,okText:"\u4fdd\u5b58",cancelText:"\u91cd\u7f6e",onOk:function(){return e.form.submit()},onCancel:function(){return e.form.resetFields()}},m.a.createElement(l.default,{ref:function(t){return e.form=t},onFinish:this.handleSubmit,initialValues:r},t?m.a.createElement(g.c,Object.assign({},i,{type:"hidden",name:"id"})):null,m.a.createElement(g.c,Object.assign({},i,{label:"\u89d2\u8272\u540d\u79f0",name:"name",required:!0})),m.a.createElement(g.c,Object.assign({},i,{label:"\u63cf\u8ff0",name:"description"}))))}}]),n}(p.Component))||j;n(265);var x=Object(b.a)({path:"/roles",ajax:!0})(k=function(e){Object(f.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={loading:!1,dataSource:[],deleting:!1,visible:!1,id:null,loadingRoleMenu:!1,selectedKeys:[],selectedRoleId:void 0},e.columns=[{title:"\u89d2\u8272\u540d\u79f0",dataIndex:"name",width:150},{title:"\u63cf\u8ff0",dataIndex:"description"},{title:"\u64cd\u4f5c",dataIndex:"operator",width:100,render:function(t,n){var a=n.id,r=n.name,i=[{label:"\u4fee\u6539",onClick:function(t){t.stopPropagation(),e.setState({visible:!0,id:a})}},{label:"\u5220\u9664",color:"red",confirm:{title:'\u60a8\u786e\u5b9a\u5220\u9664"'.concat(r,'"?'),onConfirm:function(t){t.stopPropagation(),e.handleDelete(a)}}}];return m.a.createElement(g.h,{items:i})}}],e.handleSubmit=function(t){if(!e.state.loading){var n=Object(c.a)({},t);e.setState({loading:!0}),e.props.ajax.get("/mock/role",n).then((function(t){var n=t||[];e.setState({dataSource:n}),n[0]&&e.handleRowClick(n[0])})).finally((function(){return e.setState({loading:!1})}))}},e.handleDelete=function(t){e.state.deleting||(e.setState({deleting:!0}),e.props.ajax.del("/mock/roles/".concat(t),null,{successTip:"\u5220\u9664\u6210\u529f\uff01",errorTip:"\u5220\u9664\u5931\u8d25\uff01"}).then((function(){return e.form.submit()})).finally((function(){return e.setState({deleting:!1})})))},e.handleRowClick=function(t){var n=t.id;e.setState({selectedRoleId:n,selectedKeys:[]});var a={roleId:n};e.setState({loadingRoleMenu:!0}),e.props.ajax.get("/mock/roles/menus",a).then((function(t){e.setState({selectedKeys:t})})).finally((function(){return e.setState({loadingRoleMenu:!1})}))},e.handleSaveRoleMenu=function(){var t={ids:e.state.selectedKeys};e.setState({loading:!0}),e.props.ajax.post("/mock/roles/menus",t,{successTip:"\u4fdd\u5b58\u89d2\u8272\u6743\u9650\u6210\u529f\uff01"}).then((function(e){})).finally((function(){return e.setState({loading:!1})}))},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.handleSubmit()}},{key:"render",value:function(){var e,t=this,n=this.state,a=n.loading,c=n.dataSource,s=n.visible,u=n.id,d=n.selectedRoleId,f=n.selectedKeys,p=n.loadingRoleMenu,b={form:this.props.form,width:220,style:{paddingLeft:16}},v=null===(e=c.find((function(e){return e.id===d})))||void 0===e?void 0:e.name;return m.a.createElement(h.a,{className:"root-fIjVT",loading:a||p},m.a.createElement(g.j,null,m.a.createElement(l.default,{onFinish:this.handleSubmit,ref:function(e){return t.form=e}},m.a.createElement(g.d,null,m.a.createElement(g.c,Object.assign({},b,{label:"\u89d2\u8272\u540d",name:"name"})),m.a.createElement(g.c,{layout:!0},m.a.createElement(o.default,{type:"primary",htmlType:"submit"},"\u67e5\u8be2"),m.a.createElement(o.default,{onClick:function(){return t.form.resetFields()}},"\u91cd\u7f6e"),m.a.createElement(o.default,{type:"primary",onClick:function(){return t.setState({visible:!0,id:null})}},"\u6dfb\u52a0")),m.a.createElement("div",{className:"role-menu-tip-2A5Pr"},v?m.a.createElement("span",null,"\u5f53\u524d\u89d2\u8272\u6743\u9650\uff1a\u300c",v,"\u300d"):m.a.createElement("span",null,"\u8bf7\u5728\u5de6\u4fa7\u5217\u8868\u4e2d\u9009\u62e9\u4e00\u4e2a\u89d2\u8272\uff01"),m.a.createElement(o.default,{disabled:!v,type:"primary",onClick:this.handleSaveRoleMenu},"\u4fdd\u5b58\u6743\u9650"))))),m.a.createElement(r.default,null,m.a.createElement(i.default,{span:14},m.a.createElement(g.k,{rowClassName:function(e){return e.id===d?"role-table selected":"role-table"},serialNumber:!0,columns:this.columns,dataSource:c,rowKey:"id",onRow:function(e,n){return{onClick:function(){return t.handleRowClick(e,n)}}}})),m.a.createElement(i.default,{span:10},m.a.createElement(E,{value:f,onChange:function(e){return t.setState({selectedKeys:e})}}))),m.a.createElement(O,{visible:s,id:u,isEdit:null!==u,onOk:function(){return t.setState({visible:!1},t.form.submit)},onCancel:function(){return t.setState({visible:!1})}}))}}]),n}(p.Component))||k},240:function(e,t,n){},265:function(e,t,n){e.exports={root:"root-fIjVT","role-menu-tip":"role-menu-tip-2A5Pr"}}}]);
//# sourceMappingURL=11.b3c770c5.chunk.js.map